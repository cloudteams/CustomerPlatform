{% load url from future %}
{% load staticfiles %}
{% load project_tags %}

<article class="campaign public-campaign block-line-half col-lg-6 col-md-6 col-sm-12 clear-3">
	<div class="background">
		<header class="article-header">
			<h3 class="header-medium secondary">{{campaign.name}}</h3>
			<p class="highlight bold">{{campaign.project.title}}</p>

			<div class="tooltip-container">
				<a href="#nowhere" class="open-tooltip-button"><i class="icon icon-more-options"></i></a>
				<div class="custom-tooltip">
					<ul>
						<li>
							<a href="{% url 'campaign-details' campaign.project.pk campaign.pk %}">More about this campaign</a>
						</li>
					</ul>
				</div>
			</div>
		</header>

		<div class="content dates">
			<div>
				<i class="icon icon-start"></i>
				<p><time datetime="{{ campaign.starts|date:"Y-m-d" }}">{{ campaign.starts|date:"d-m-Y" }}</time></p>
			</div>
            {% if campaign.expires %}
				<div>
                	<i class="icon icon-close2"></i>
                	<p><time datetime="{{ campaign.expires|date:"Y-m-d" }}">{{ campaign.expires|date:"d-m-Y" }}</time></p>
				</div>
            {% endif %}
		</div>

		<div class="content data">
			<table>
				<tr class="row">
					<td class="col-xs-5">
						<i class="icon icon-add-member"></i>
						<p>Participants</p>
					</td>
					<td class="col-xs-7">
						<p class="bold">{{ campaign.count_participants }}</p>
					</td>
				</tr>

				<tr class="row">
					<td class="col-xs-5">
						<i class="icon icon-time"></i>
						<p>Days left</p>
					</td>
					<td class="col-xs-7">
						<p class="bold">{{ campaign|print_days_left }}</p>
					</td>
				</tr>
			</table>
		</div>

		<footer>
            <div class="row">
                <div class="col-xs-12">
                    <a href="{% url 'campaign-details' campaign.project.pk campaign.pk %}"
                       class="btn-transparent col-xs-12">See all info</a>

                    {% if not campaign.has_expired %}
                        {% for poll in campaign.polls.all %}
                            <a href="{% if request.user.is_authenticated %}{{ poll|get_poll_token_link:request.user }}{% else %}/activitytracker/login/?next={% url 'campaign-details' campaign.project.pk campaign.pk %}{% endif %}"
                               class="btn col-xs-12"
                               {% if request.user.is_authenticated %}target="_blank"{% endif %}>Participate in poll</a>
                        {% endfor %}

                        {% for document in campaign.documents.all %}
                            <a href="{% if request.user.is_authenticated %}{{ document.link }}{% else %}/activitytracker/login/?next={% url 'campaign-details' campaign.project.pk campaign.pk %}{% endif %}"
                               target="_blank"
                               class="btn col-xs-12" style="padding: 10px;"
                               title="View document {{ document.name }}"><i class="icon icon-document"></i> {{ document.name }}</a>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
		</footer>
	</div>
</article>